CREATE PROCEDURE Paciente.InsertarPaciente
    @id_cobertura INT = NULL, -- Lo dejamos como nulo ya que se insertará como identity(1,1). La inserción le da el id secuencial de 1 en 1
    @nombre VARCHAR(50),
    @apellido VARCHAR(50),
    @apellido_materno VARCHAR(50) = NULL,
    @fecha_de_nacimiento DATE,
    @tipo_documento VARCHAR(25),
    @sexo_biologico CHAR(1),
    @genero CHAR(1),
    @nacionalidad VARCHAR(18),
    @foto_de_perfil VARCHAR(255) = NULL,
    @mail VARCHAR(100),
    @telefono_fijo CHAR(15) = NULL,
    @telefono_de_contacto_alternativo CHAR(15) = NULL,
    @telefono_laboral CHAR(15) = NULL,
    @usuario_actualizacion INT
AS
BEGIN
    -- Validaciones de campos obligatorios
    IF @nombre IS NULL
    BEGIN
        RAISERROR ('El campo  nombre es obligatorio.', 16, 1);
        RETURN;
    END

    IF @apellido IS NULL
    BEGIN
        RAISERROR ('El campo apellido es obligatorio.', 16, 1);
        RETURN;
    END

    IF @fecha_de_nacimiento IS NULL
    BEGIN
        RAISERROR ('El campo fecha de nacimiento es obligatorio.', 16, 1);
        RETURN;
    END

    IF @tipo_documento IS NULL
    BEGIN
        RAISERROR ('El campo tipo_documento es obligatorio.', 16, 1);
        RETURN;
    END

    IF @sexo_biologico IS NULL
    BEGIN
        RAISERROR ('El campo sexo_biologico es obligatorio.', 16, 1);
        RETURN;
    END

    IF @genero IS NULL
    BEGIN
        RAISERROR ('El campo genero es obligatorio.', 16, 1);
        RETURN;
    END

    IF @nacionalidad IS NULL
    BEGIN
        RAISERROR ('El campo nacionalidad es obligatorio.', 16, 1);
        RETURN;
    END

    IF @mail IS NULL
    BEGIN
        RAISERROR ('El campo mail es obligatorio.', 16, 1);
        RETURN;
    END

    IF @usuario_actualizacion IS NULL
    BEGIN
        RAISERROR ('El campo usuario_actualizacion es obligatorio.', 16, 1); -- ver si tomamos el dato de que se obtenga el id del usuario que lo está insertando
        RETURN;
    END

    INSERT INTO Paciente.Paciente (
        id_cobertura,
        nombre,
        apellido,
        apellido_materno,
        fecha_de_nacimiento,
        tipo_documento,
        sexo_biologico,
        genero,
        nacionalidad,
        foto_de_perfil,
        mail,
        telefono_fijo,
        telefono_de_contacto_alternativo,
        telefono_laboral,
        fecha_de_registro,
        fecha_de_actualizacion,
        usuario_actualizacion
    ) VALUES (
        @id_cobertura,
        @nombre,
        @apellido,
        @apellido_materno,
        @fecha_de_nacimiento,
        @tipo_documento,
        @sexo_biologico,
        @genero,
        @nacionalidad,
        @foto_de_perfil,
        @mail,
        @telefono_fijo,
        @telefono_de_contacto_alternativo,
        @telefono_laboral,
        GETDATE(),
        GETDATE(),
        @usuario_actualizacion
    )
END
GO
CREATE PROCEDURE Paciente.InsertarUsuario
    @id_historia_clinica INT,
    @nombre_usuario VARCHAR(50),
    @contrasenia VARCHAR(255),
    @fecha_borrado DATETIME = NULL
AS
BEGIN
    -- Validaciones de campos obligatorios

    IF @nombre_usuario IS NULL
    BEGIN
        RAISERROR ('El campo nombre_usuario es obligatorio.', 16, 1);
        RETURN;
    END

    IF @contrasenia IS NULL
    BEGIN
        RAISERROR ('El campo contrasenia es obligatorio.', 16, 1);
        RETURN;
    END

    INSERT INTO Paciente.Usuario (
        id_historia_clinica,
        nombre_usuario,
        contrasenia,
        fecha_de_creacion,
        fecha_borrado
    ) VALUES (
        @id_historia_clinica,
        @nombre_usuario,
        @contrasenia,
        GETDATE(),
        @fecha_borrado
    )
END
GO
CREATE PROCEDURE Paciente.InsertarDomicilio
    @id_historia_clinica INT,
    @calle VARCHAR(50),
    @numero INT,
    @piso INT,
    @departamento CHAR(10),
    @codigo_postal CHAR(10) = NULL,
    @pais VARCHAR(40),
    @provincia VARCHAR(50),
    @localidad VARCHAR(50)
AS
BEGIN
    INSERT INTO Paciente.Domicilio (
        id_historia_clinica,
        calle,
        numero,
        piso,
        departamento,
        codigo_postal,
        pais,
        provincia,
        localidad
    ) VALUES (
        @id_historia_clinica,
        @calle,
        @numero,
        @piso,
        @departamento,
        @codigo_postal,
        @pais,
        @provincia,
        @localidad
    )
END
GO
CREATE PROCEDURE Paciente.InsertarEstudio
    @id_historia_clinica INT,
    @fecha DATE,
    @nombre_estudio VARCHAR(100),
    @autorizado BIT,
    @documento_resultado VARCHAR(255),
    @imagen_resultado VARCHAR(255)
AS
BEGIN
    -- Si la fecha no se proporciona, se genera un error
    IF @fecha IS NULL
    BEGIN
        RAISERROR ('La fecha es un campo obligatorio.', 16, 1);
        RETURN;
    END

    INSERT INTO Paciente.Estudio (
        id_historia_clinica,
        fecha,
        nombre_estudio,
        autorizado,
        documento_resultado,
        imagen_resultado
    ) VALUES (
        @id_historia_clinica,
        @fecha,
        @nombre_estudio,
        @autorizado,
        @documento_resultado,
        @imagen_resultado
    )
END
GO
CREATE PROCEDURE Paciente.InsertarPago
    @id_historia_clinica INT,
    @fecha DATE,
    @monto DECIMAL(10, 2)
AS
BEGIN

    IF @monto IS NULL
    BEGIN
        RAISERROR ('El campo monto es obligatorio.', 16, 1);
        RETURN;
    END

    INSERT INTO Paciente.Pago (
        id_historia_clinica,
        fecha,
        monto
    ) VALUES (
        @id_historia_clinica,
        @fecha,
        @monto
    )
END